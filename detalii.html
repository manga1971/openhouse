<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Detalii Înregistrare – Audioform</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #1a202c, #2d3748);
      min-height: 100vh;
      color: white;
    }
    .glass {
      background: rgba(255, 255, 255, 0.08);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    .pulse {
      animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
  </style>
</head>
<body class="flex items-center justify-center p-4">
  <div class="glass p-6 rounded-xl max-w-xl w-full">
    <h1 class="text-3xl font-bold mb-4 text-white">Detalii Înregistrare</h1>
    <div id="recordDetail">
      <p class="text-indigo-300 mb-2 text-sm" id="recordStatus"></p>
      <p class="text-xl font-semibold mb-2" id="recordName">...</p>
      <p class="text-sm text-gray-300 mb-4" id="recordTime">...</p>

      <audio controls class="w-full mb-4 rounded">
        <source id="audioSource" src="" type="audio/webm">
        Browserul nu suportă redarea audio.
      </audio>

      <div class="flex flex-col gap-2 mt-4">
        <textarea id="noteField" rows="6" class="w-full p-3 rounded-lg text-black" placeholder="Scrie o notiță sau transcriere..."></textarea>
        <button id="saveBtn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300">
          Salvează Notița
        </button>
        <button id="downloadBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300">
          Descarcă ca PDF
        </button>
        <a href="index.html" class="mt-4 inline-block text-sm text-indigo-300 underline hover:text-white transition">
          ⬅ Înapoi la înregistrări
        </a>
      </div>
    </div>
  </div>

  <script>
    const params = new URLSearchParams(window.location.search);
    const id = params.get("id");

    const allRecords = JSON.parse(localStorage.getItem("recordsMeta") || "[]");
    const record = allRecords.find(r => r.id === id);

    if (!record) {
      document.getElementById("recordDetail").innerHTML = "<p class='text-red-400'>Înregistrarea nu a fost găsită.</p>";
    } else {
      document.getElementById("recordName").textContent = record.nume;
      document.getElementById("recordTime").textContent = "Salvat la: " + record.ora;
      document.getElementById("audioSource").src = record.data;
      document.getElementById("recordStatus").textContent = 
        record.status === "done" ? "✔ Finalizat" : record.status === "draft" ? "✎ În lucru" : "⚠ Neînceput";

      const textarea = document.getElementById("noteField");
      textarea.value = record.notes || "";

      document.getElementById("saveBtn").addEventListener("click", () => {
        record.notes = textarea.value;
        const updated = allRecords.map(r => r.id === id ? record : r);
        localStorage.setItem("recordsMeta", JSON.stringify(updated));
        alert("Notița a fost salvată cu succes!");
      });

      document.getElementById("downloadBtn").addEventListener("click", () => {
        const container = document.createElement("div");
        container.innerHTML = `
          <h1 style="font-size:24px;">Raport Audio – ${record.nume}</h1>
          <p><strong>Status:</strong> ${record.status}</p>
          <p><strong>Data:</strong> ${record.ora}</p>
          <p><strong>Notiță:</strong></p>
          <p>${(record.notes || "").replace(/\n/g, "<br>")}</p>
        `;
        html2pdf().from(container).save(`Raport_${record.nume}_${record.ora}.pdf`);
      });
    }
  </script>
</body>
</html>
