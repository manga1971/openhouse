<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lum ‚Äì Home</title>
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header class="w-full flex justify-between items-center px-4 py-3 shadow fixed top-0 z-50">
        <h1 class="text-lg font-bold tracking-wider">Lum</h1>
        <div class="flex space-x-4 text-center">
            <button class="flex flex-col items-center text-xs" aria-label="View your rewards">
                <span class="text-xl">‚≠ê</span> Rewards
            </button>
            <button class="flex flex-col items-center text-xs" aria-label="Chat with AI assistant">
                <span class="text-xl">ü§ñ</span> AI Chat
            </button>
            <button class="flex flex-col items-center text-xs" aria-label="Access your account settings">
                <span class="text-xl">üë§</span> Account
            </button>
        </div>
    </header>

    <main>
        <section class="mt-20 px-4 text-center">
            <div id="textSlider" aria-live="polite" class="rounded p-2 text-sm transition-opacity duration-500 ease-in-out opacity-100">
                Motto: strive for progress not perfection
            </div>
        </section>

        <section class="carousel-container relative">
            <div class="carousel px-4 mt-6 pb-4 flex overflow-x-scroll snap-x snap-mandatory" id="carousel">
                <a href="resources.html" class="slide resources-slide rounded-lg shadow-lg flex flex-col justify-end" aria-label="Explore resources for eye wellness (duplicate)">
                    <h2 class="text-xl font-semibold mb-2">Resources</h2>
                    <p class="text-sm">Visual, audio materials, and guides for eye wellness.</p>
                </a>
                <a href="recommends.html" class="slide recommendations-slide rounded-lg shadow-lg flex flex-col justify-end" aria-label="Go to Recommendations section">
                    <h2 class="text-xl font-semibold mb-2">Recommends</h2>
                    <p class="text-sm">Personalized exercises and tips for your eyes.</p>
                </a>
                <a href="vision-test.html" class="slide lum-test-slide rounded-lg shadow-lg flex flex-col justify-between" aria-label="Take the Lum Vision Test">
                    <span class="date">Thursday, July 10</span>
                    <div>
                        <h2 class="text-xl font-semibold mb-2">Lum Test</h2>
                        <p class="text-sm">Take a quick test now and find out how your eyes are doing.</p>
                    </div>
                </a>
                <a href="reports.html" class="slide reports-slide rounded-lg shadow-lg flex flex-col justify-end" aria-label="View your progress reports">
                    <h2 class="text-xl font-semibold mb-2">Reports</h2>
                    <p class="text-sm">Visualize your test history and inner light progress.</p>
                </a>
                <a href="resources.html" class="slide resources-slide rounded-lg shadow-lg flex flex-col justify-end" aria-label="Explore resources for eye wellness">
                    <h2 class="text-xl font-semibold mb-2">Resources</h2>
                    <p class="text-sm">Visual, audio materials, and guides for eye wellness.</p>
                </a>

                <a href="recommends.html" class="slide recommendations-slide rounded-lg shadow-lg flex flex-col justify-end" aria-label="Go to Recommendations section (duplicate)">
                    <h2 class="text-xl font-semibold mb-2">Recommends</h2>
                    <p class="text-sm">Personalized exercises and tips for your eyes.</p>
                </a>
                </div>
            <div class="absolute inset-y-0 right-0 w-8 bg-gradient-to-l from-[var(--color-background)] to-transparent pointer-events-none flex items-center justify-center pr-2">
                <span class="text-2xl">‚Üí</span>
            </div>
        </section>

        <div class="flex justify-center space-x-2 mt-2" id="carousel-indicators">
        </div>

        <section id="permanent-disclaimer" class="mt-4 px-4">
            Disclaimer: Always consult a healthcare professional for medical advice. This app is for informational purposes only.
        </section>
    </main>

    <nav class="fixed bottom-0 left-0 w-full shadow-inner flex justify-around items-center h-16 z-50">
        <a href="index.html" class="nav-item flex flex-col items-center text-xs" id="nav-home" aria-label="Go to Home page">
            <span class="text-lg">üè†</span> Home
        </a>
        <a href="recommends.html" class="nav-item flex flex-col items-center text-xs" id="nav-recommends" aria-label="Go to Recommends page">
            <span class="text-lg">‚úÖ</span> Recommends
        </a>
        <a href="vision-test.html" class="nav-item flex flex-col items-center text-xs font-semibold active" id="nav-lum-test" aria-label="Go to Lum Test page">
            <span class="text-lg">üëÅÔ∏è</span> Lum Test
        </a>
        <a href="reports.html" class="nav-item flex flex-col items-center text-xs" id="nav-reports" aria-label="Go to Reports page">
            <span class="text-lg">üìà</span> Reports
        </a>
        <a href="resources.html" class="nav-item flex flex-col items-center text-xs" id="nav-resources" aria-label="Go to Resources page">
            <span class="text-lg">üìö</span> Resources
        </a>
    </nav>

    <div id="initial-disclaimer-popup" role="alert">
        <p class="font-bold mb-2">Important Disclaimer:</p>
        <p>Always consult a healthcare professional for medical advice. This app is for informational purposes only and not a diagnostic tool.</p>
        <div class="flex items-center mt-4">
            <button id="hide-initial-disclaimer">Got it!</button>
            <input type="checkbox" id="dont-show-initial-disclaimer-again" class="ml-4">
            <label for="dont-show-initial-disclaimer-again">Don't show this again</label>
        </div>
    </div>

    <script>
        // --- Text Slider Logic (Motto) ---
        // Messages for the Home page specific slider
        const homePageMessages = [
            "Motto: strive for progress not perfection",
            "Goal: cultivate light in your eyes every day",
            "Lum: your daily partner for eye well-being", // Added a Lum specific message
        ];
        let currentMessageIndex = 0;
        const textSliderElement = document.getElementById("textSlider");

        function updateTextSlider() {
            textSliderElement.classList.remove("opacity-100");
            textSliderElement.classList.add("opacity-0");

            setTimeout(() => {
                currentMessageIndex = (currentMessageIndex + 1) % homePageMessages.length;
                textSliderElement.textContent = homePageMessages[currentMessageIndex];
                textSliderElement.classList.remove("opacity-0");
                textSliderElement.classList.add("opacity-100");
            }, 500); // Duration of fade-out transition
        }

        setInterval(updateTextSlider, 4000); // Change text every 4 seconds
        updateTextSlider(); // Initial call to set the first message and start the cycle

        // --- Carousel Indicators Logic ---
        const carousel = document.getElementById('carousel');
        const indicatorsContainer = document.getElementById('carousel-indicators');
        // We now have 4 real slides + 2 duplicates
        const REAL_SLIDES_COUNT = 4; 
        const slides = carousel.querySelectorAll('.slide'); // This will get all slides, including duplicates

        // Create indicators only for real slides
        for (let i = 0; i < REAL_SLIDES_COUNT; i++) {
            const indicator = document.createElement('span');
            indicator.className = 'w-2 h-2 rounded-full cursor-pointer';
            indicator.setAttribute('data-slide-index', i);
            indicatorsContainer.appendChild(indicator);
        }

        const indicators = indicatorsContainer.children;

        // Function to scroll to a specific real slide index (0 to REAL_SLIDES_COUNT - 1)
        function scrollToRealSlide(index, behavior = 'smooth') {
            const firstRealSlide = slides[1]; // The first real slide (index 1 in the HTML with duplicates)
            const slideWidth = firstRealSlide.offsetWidth + parseFloat(getComputedStyle(firstRealSlide).marginRight);
            // Scroll to the corresponding position, accounting for the first duplicate
            carousel.scrollTo({
                left: (index + 1) * slideWidth, // +1 because index 0 is the first duplicate
                behavior: behavior
            });
        }

        let isScrolling = false; // Flag to prevent rapid re-scrolling

        function updateCarouselIndicatorsAndLoop() {
            if (isScrolling) return; // Prevent loop logic interference during manual scroll

            const scrollLeft = carousel.scrollLeft;
            const firstRealSlide = slides[1];
            if (!firstRealSlide) return; // Guard against empty carousel

            const slideWidth = firstRealSlide.offsetWidth + parseFloat(getComputedStyle(firstRealSlide).marginRight);

            // Calculate current "real" index based on scroll position
            // Adjust for the leading duplicate
            let currentRealIndex = Math.round((scrollLeft - slideWidth) / slideWidth); 
            
            // Handle looping: snap back to real start/end without visible transition
            if (scrollLeft <= 0) { // If scrolled past the first real slide (into leading duplicate)
                isScrolling = true;
                carousel.scrollTo({
                    left: (REAL_SLIDES_COUNT) * slideWidth, // Jump to the real equivalent of the duplicate
                    behavior: 'auto'
                });
                currentRealIndex = REAL_SLIDES_COUNT -1; // Set current index to the last real slide
            } else if (scrollLeft >= (REAL_SLIDES_COUNT + 1) * slideWidth - 1) { // If scrolled past last real slide (into trailing duplicate)
                isScrolling = true;
                carousel.scrollTo({
                    left: slideWidth, // Jump to the first real slide
                    behavior: 'auto'
                });
                currentRealIndex = 0; // Set current index to the first real slide
            }

            // Update indicators for the real slides
            for (let i = 0; i < REAL_SLIDES_COUNT; i++) {
                if (i === currentRealIndex) {
                    indicators[i].classList.remove('bg-gray-300');
                    indicators[i].classList.add('bg-gray-400');
                } else {
                    indicators[i].classList.remove('bg-gray-400');
                    indicators[i].classList.add('bg-gray-300');
                }
            }
        }

        carousel.addEventListener('scroll', updateCarouselIndicatorsAndLoop);
        
        // Reset isScrolling flag after a short delay to allow for scroll animation to complete
        carousel.addEventListener('scrollend', () => {
             // This event fires when scroll is complete. Useful for browsers supporting it.
             isScrolling = false;
        });

        // Fallback for browsers that don't support 'scrollend'
        let scrollTimeout;
        carousel.addEventListener('scroll', () => {
            clearTimeout(scrollTimeout);
            scrollTimeout = setTimeout(() => {
                isScrolling = false;
            }, 100); // Small debounce time
        });

        // Allow clicking indicators to scroll carousel
        indicatorsContainer.addEventListener('click', (event) => {
            const clickedIndicator = event.target.closest('[data-slide-index]');
            if (clickedIndicator) {
                const slideIndex = parseInt(clickedIndicator.getAttribute('data-slide-index'));
                scrollToRealSlide(slideIndex);
            }
        });

        // Initial setup for carousel: scroll to the first real slide immediately on load
        window.addEventListener('load', () => {
            // Ensure slides are rendered before attempting to scroll
            const firstRealSlide = slides[1];
            if (firstRealSlide) {
                const slideWidth = firstRealSlide.offsetWidth + parseFloat(getComputedStyle(firstRealSlide).marginRight);
                carousel.scrollTo({
                    left: slideWidth, // Scroll to the first actual slide (index 1)
                    behavior: 'auto'
                });
                updateCarouselIndicatorsAndLoop(); // Set initial indicator
            }
        });
        

        // --- Navbar Active State Logic ---
        const navItems = document.querySelectorAll('.nav-item');

        function setActiveNavItem(id) {
            navItems.forEach(item => {
                item.classList.remove('active', 'font-semibold', 'text-orange-500', 'text-blue-600');
                item.classList.add('text-gray-700'); // Default inactive color
            });

            const activeItem = document.getElementById(id);
            if (activeItem) {
                activeItem.classList.add('active', 'font-semibold');
                // Use CSS variables defined in style.css or direct Tailwind classes for colors
                if (id === 'nav-lum-test') {
                    activeItem.classList.add('text-orange-500'); // Example: Use Tailwind orange for Lum Test
                }
                activeItem.classList.remove('text-gray-700'); // Remove inactive color
            }
        }

        // Set 'Lum Test' as active by default on Home page load
        setActiveNavItem('nav-lum-test');


        // --- Initial Disclaimer Popup Logic ---
        const initialDisclaimerPopup = document.getElementById('initial-disclaimer-popup');
        const hideInitialDisclaimerBtn = document.getElementById('hide-initial-disclaimer');
        const dontShowInitialDisclaimerAgainCheckbox = document.getElementById('dont-show-initial-disclaimer-again');

        const initialDisclaimerKey = 'lum_initial_disclaimer_hidden'; // Key for localStorage

        function showInitialDisclaimerPopup() {
            const hiddenPreference = localStorage.getItem(initialDisclaimerKey);
            // Only show if it hasn't been hidden before
            if (hiddenPreference !== 'true') {
                initialDisclaimerPopup.classList.add('show');
            }
        }

        hideInitialDisclaimerBtn.addEventListener('click', () => {
            initialDisclaimerPopup.classList.remove('show');
            // Save preference if checkbox is checked
            if (dontShowInitialDisclaimerAgainCheckbox.checked) {
                localStorage.setItem(initialDisclaimerKey, 'true');
            }
        });

        dontShowInitialDisclaimerAgainCheckbox.addEventListener('change', () => {
            // Update localStorage immediately on change
            localStorage.setItem(initialDisclaimerKey, dontShowInitialDisclaimerAgainCheckbox.checked);
        });

        // Show the initial disclaimer popup when the page loads
        window.addEventListener('load', showInitialDisclaimerPopup);

    </script>
</body>
</html>
