<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" /> <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard – AudioForm</title>

  <link rel="manifest" href="/manifest.json" />
  <meta name="theme-color" content="#1e40af" /> 

  <link rel="preconnect" href="https://cdn.tailwindcss.com">
  <link rel="preconnect" href="https://cdnjs.cloudflare.com">

  <script src="https://cdn.tailwindcss.com"></script>

  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
  />

  <link rel="stylesheet" href="style.css" />

  </head>

<body class="bg-gray-50 text-gray-800 antialiased min-h-screen flex flex-col
             dark:bg-gray-900 dark:text-gray-100 transition-colors duration-300">
  
  <nav class="bg-white shadow-md px-4 py-3 flex items-center justify-between sticky top-0 z-50
              dark:bg-gray-800 dark:shadow-lg transition-colors duration-300">
    <h1 class="text-xl font-semibold text-gray-900 dark:text-gray-50">Salut, Mike!</h1>
    <button
      id="menu-toggle"
      class="text-2xl p-2 rounded-md hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-150 ease-in-out
             dark:hover:bg-gray-700 dark:focus:ring-blue-400 dark:text-gray-50"
      aria-label="Deschide meniul de navigare"
      aria-expanded="false"
    >
      <i class="fas fa-bars"></i>
    </button>
  </nav>

  <aside id="main-menu" class="fixed inset-y-0 right-0 w-64 bg-white shadow-lg transform translate-x-full 
                              transition-transform duration-300 ease-in-out z-40 p-6 flex flex-col items-start space-y-4
                              dark:bg-gray-800 dark:shadow-xl">
    <button id="close-menu" class="absolute top-4 right-4 text-gray-500 hover:text-gray-800 text-2xl
                                   dark:text-gray-400 dark:hover:text-gray-50" aria-label="Închide meniul">
        <i class="fas fa-times"></i>
    </button>
    <a href="#" class="text-blue-600 hover:text-blue-800 text-lg font-medium py-2 w-full text-left" aria-current="page">
        <i class="fas fa-home mr-3"></i> Acasă
    </a>
    <a href="templates.html" class="text-gray-700 hover:text-blue-800 text-lg font-medium py-2 w-full text-left dark:text-gray-200">
        <i class="fas fa-layer-group mr-3"></i> Șabloane
    </a>
    <a href="reports.html" class="text-gray-700 hover:text-blue-800 text-lg font-medium py-2 w-full text-left dark:text-gray-200">
        <i class="fas fa-file-alt mr-3"></i> Rapoarte
    </a>
    <a href="settings.html" class="text-gray-700 hover:text-blue-800 text-lg font-medium py-2 w-full text-left dark:text-gray-200">
        <i class="fas fa-cog mr-3"></i> Setări
    </a>
    <a href="logout.html" class="text-gray-700 hover:text-red-600 text-lg font-medium py-2 w-full text-left mt-auto dark:text-gray-200">
        <i class="fas fa-sign-out-alt mr-3"></i> Delogare
    </a>
  </aside>

  <div id="menu-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-30 hidden"></div>

  <main class="flex-grow px-4 py-5 space-y-6 max-w-4xl mx-auto w-full">
    <div id="plugin-slot-dashboard-top" class="w-full">
      </div>

    <section aria-labelledby="search-heading">
      <h2 id="search-heading" class="sr-only">Căutare rapoarte</h2>
      <label for="report-search" class="sr-only">Caută rapoarte după VIN, client, model</label>
      <div class="relative">
        <input
          type="text"
          id="report-search"
          placeholder="Caută rapoarte după VIN, client, model..."
          class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500
                 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100 dark:placeholder-gray-400 dark:focus:ring-blue-400"
          aria-label="Câmp de căutare pentru rapoarte"
        />
        <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 dark:text-gray-400"></i>
      </div>
    </section>

    <section class="text-center text-md text-gray-700 italic font-light dark:text-gray-300" aria-label="Motto-ul aplicației">
      <p>"Fiecare vorbă, un raport complet."</p>
      <p>"Transformă vocea în documente. Rapid. Precis."</p>
    </section>

    <section aria-labelledby="quick-templates-heading">
      <h2 id="quick-templates-heading" class="text-xl font-semibold mb-3 text-gray-800 dark:text-gray-100">Șabloanele tale rapide</h2>
      <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4">
        <button class="template-btn bg-white shadow-md rounded-lg p-4 flex flex-col items-center justify-center text-center
                       hover:bg-blue-50 transition duration-200 ease-in-out transform hover:-translate-y-1 hover:shadow-lg
                       dark:bg-gray-700 dark:hover:bg-gray-600 dark:shadow-xl dark:text-gray-100"
                data-template-id="F1" data-template-name="Fișă Reparație" aria-label="Creează Fișă Reparație">
          <i class="fas fa-wrench text-3xl text-blue-600 dark:text-blue-400 mb-2"></i>
          <span class="text-sm font-medium text-gray-800 dark:text-gray-100">Reparație</span>
        </button>

        <button class="template-btn bg-white shadow-md rounded-lg p-4 flex flex-col items-center justify-center text-center
                       hover:bg-blue-50 transition duration-200 ease-in-out transform hover:-translate-y-1 hover:shadow-lg
                       dark:bg-gray-700 dark:hover:bg-gray-600 dark:shadow-xl dark:text-gray-100"
                data-template-id="F2" data-template-name="Fișă Revizie" aria-label="Creează Fișă Revizie">
          <i class="fas fa-oil-can text-3xl text-blue-600 dark:text-blue-400 mb-2"></i>
          <span class="text-sm font-medium text-gray-800 dark:text-gray-100">Revizie</span>
        </button>

        <button class="template-btn bg-white shadow-md rounded-lg p-4 flex flex-col items-center justify-center text-center
                       hover:bg-blue-50 transition duration-200 ease-in-out transform hover:-translate-y-1 hover:shadow-lg
                       dark:bg-gray-700 dark:hover:bg-gray-600 dark:shadow-xl dark:text-gray-100"
                data-template-id="F3" data-template-name="Fișă Diagnostic" aria-label="Creează Fișă Diagnostic">
          <i class="fas fa-vial text-3xl text-blue-600 dark:text-blue-400 mb-2"></i>
          <span class="text-sm font-medium text-gray-800 dark:text-gray-100">Diagnostic</span>
        </button>

        <button class="template-btn bg-white shadow-md rounded-lg p-4 flex flex-col items-center justify-center text-center
                       hover:bg-blue-50 transition duration-200 ease-in-out transform hover:-translate-y-1 hover:shadow-lg
                       dark:bg-gray-700 dark:hover:bg-gray-600 dark:shadow-xl dark:text-gray-100"
                data-template-id="F4" data-template-name="Observații Generale" aria-label="Creează Observații Generale">
          <i class="fas fa-sticky-note text-3xl text-blue-600 dark:text-blue-400 mb-2"></i>
          <span class="text-sm font-medium text-gray-800 dark:text-gray-100">Observații</span>
        </button>

        <button class="template-btn bg-white shadow-md rounded-lg p-4 flex flex-col items-center justify-center text-center
                       hover:bg-blue-50 transition duration-200 ease-in-out transform hover:-translate-y-1 hover:shadow-lg
                       dark:bg-gray-700 dark:hover:bg-gray-600 dark:shadow-xl dark:text-gray-100"
                data-template-id="F5" data-template-name="Fișă Vopsitorie" aria-label="Creează Fișă Vopsitorie">
          <i class="fas fa-paint-roller text-3xl text-blue-600 dark:text-blue-400 mb-2"></i>
          <span class="text-sm font-medium text-gray-800 dark:text-gray-100">Vopsitorie</span>
        </button>

        <button class="template-btn bg-white shadow-md rounded-lg p-4 flex flex-col items-center justify-center text-center
                       hover:bg-blue-50 transition duration-200 ease-in-out transform hover:-translate-y-1 hover:shadow-lg"
                data-template-id="F6" data-template-name="Fișă Suspensie" aria-label="Creează Fișă Suspensie">
          <i class="fas fa-cogs text-3xl text-blue-600 dark:text-blue-400 mb-2"></i>
          <span class="text-sm font-medium text-gray-800 dark:text-gray-100">Suspensie</span>
        </button>

        <button class="template-btn bg-white shadow-md rounded-lg p-4 flex flex-col items-center justify-center text-center
                       hover:bg-blue-50 transition duration-200 ease-in-out transform hover:-translate-y-1 hover:shadow-lg"
                data-template-id="F7" data-template-name="Fișă Electrică" aria-label="Creează Fișă Electrică">
          <i class="fas fa-car-battery text-3xl text-blue-600 dark:text-blue-400 mb-2"></i>
          <span class="text-sm font-medium text-gray-800 dark:text-gray-100">Electrică</span>
        </button>

        <button class="template-btn bg-white shadow-md rounded-lg p-4 flex flex-col items-center justify-center text-center
                       hover:bg-blue-50 transition duration-200 ease-in-out transform hover:-translate-y-1 hover:shadow-lg"
                data-template-id="F8" data-template-name="Fișă Caroserie" aria-label="Creează Fișă Caroserie">
          <i class="fas fa-car-side text-3xl text-blue-600 dark:text-blue-400 mb-2"></i>
          <span class="text-sm font-medium text-gray-800 dark:text-gray-100">Caroserie</span>
        </button>
      </div>
    </section>

    <section class="mt-6 flex flex-col sm:flex-row justify-center items-center gap-4">
      <a href="templates.html" class="bg-blue-600 text-white px-6 py-3 rounded-full shadow-md hover:bg-blue-700
                                      transition duration-200 ease-in-out transform hover:-translate-y-1 hover:shadow-lg flex items-center justify-center w-full sm:w-auto
                                      dark:bg-blue-700 dark:hover:bg-blue-600">
        <i class="fas fa-plus mr-2"></i> Creează șablon nou
      </a>
      <a href="reports.html" class="flex items-center gap-2 text-blue-600 cursor-pointer hover:underline text-base
                                      hover:text-blue-800 transition duration-150 ease-in-out px-4 py-2 rounded-md
                                      dark:text-blue-400 dark:hover:text-blue-300">
        <i class="fas fa-folder-open text-lg"></i>
        <span>Istoric Șabloane</span>
      </a>
    </section>

    <section class="mt-6 bg-white p-4 rounded-lg shadow space-y-2
                    dark:bg-gray-700 dark:shadow-xl dark:text-gray-100" aria-labelledby="subscription-summary-heading">
      <h3 id="subscription-summary-heading" class="font-semibold text-gray-700 dark:text-gray-100">Utilizare Abonament</h3>
      <p>🎙️ Minute folosite: <span class="font-medium text-gray-900 dark:text-gray-50">14</span> / 120</p>
      <p>📄 Rapoarte generate: <span class="font-medium text-gray-900 dark:text-gray-50">7</span> / lună</p>
      <a href="upgrade-plan.html" class="text-blue-600 hover:underline text-sm block mt-2 dark:text-blue-400">Upgrade plan</a>
    </section>

    <section class="mt-4 bg-white p-4 rounded-lg shadow space-y-2
                    dark:bg-gray-700 dark:shadow-xl dark:text-gray-100" aria-labelledby="notifications-heading">
      <h3 id="notifications-heading" class="font-semibold text-gray-700 dark:text-gray-100">Notificări</h3>
      <ul class="list-disc pl-5 text-sm text-gray-600 dark:text-gray-200">
        <li>✅ Șablonul "Fișă Caroserie" a fost actualizat.</li>
        <li>🔄 Integrare Dropbox disponibilă.</li>
      </ul>
    </section>

    </main>

  <nav class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 shadow-inner flex justify-around items-center h-14 sm:hidden z-50
              dark:bg-gray-800 dark:border-gray-700 dark:shadow-2xl">
    <a href="#" class="flex flex-col items-center text-blue-600 hover:text-blue-800 text-sm active:text-blue-900 focus:outline-none focus:ring-2 focus:ring-blue-500 rounded-md p-1
       dark:text-blue-400 dark:hover:text-blue-300 dark:focus:ring-blue-400"
       aria-current="page" aria-label="Acasă - Dashboard">
      <i class="fas fa-home text-lg"></i>
      <span>Acasă</span>
    </a>
    <a href="recording.html" class="flex flex-col items-center text-blue-600 hover:text-blue-800 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 rounded-md p-1
       dark:text-blue-400 dark:hover:text-blue-300 dark:focus:ring-blue-400"
       aria-label="Creează un Raport Nou">
      <i class="fas fa-microphone-alt text-lg"></i>
      <span>Raport</span>
    </a>
    <a href="settings.html" class="flex flex-col items-center text-blue-600 hover:text-blue-800 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 rounded-md p-1
       dark:text-blue-400 dark:hover:text-blue-300 dark:focus:ring-blue-400"
       aria-label="Accesează Setările Contului">
      <i class="fas fa-user-cog text-lg"></i>
      <span>Setări</span>
    </a>
  </nav>

  <script>
    document.addEventListener('DOMContentLoaded', () => {

      // 1. Autodetect Dark Mode Preference & Apply
      const applyDarkMode = () => {
        if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
          document.documentElement.classList.add('dark');
        } else {
          document.documentElement.classList.remove('dark');
        }
      };
      // Apply on load
      applyDarkMode();
      // Listen for changes in system preference
      window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', applyDarkMode);
      // Optional: Store user preference in localStorage for explicit override later
      // if (localStorage.getItem('theme') === 'dark') { document.documentElement.classList.add('dark'); }


      // 2. PWA - Register Service Worker (for caching offline)
      // This part requires a manifest.json and service-worker.js file in the root.
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/service-worker.js')
            .then(registration => {
              console.log('PWA ServiceWorker registered:', registration);
            })
            .catch(error => {
              console.error('PWA ServiceWorker registration failed:', error);
            });
        });
      }

      // 3. Token Securizat pentru Redirecționare (UUIDv4)
      const templateButtons = document.querySelectorAll('.template-btn');
      templateButtons.forEach(button => {
        button.addEventListener('click', () => {
          const templateId = button.dataset.templateId;
          const templateName = button.dataset.templateName;
          
          try {
            // Generate a secure, temporary UUIDv4 token
            const token = crypto.randomUUID(); 
            // Store data in sessionStorage, linked by the token
            // sessionStorage is more secure for temporary data than localStorage as it's cleared on tab close.
            sessionStorage.setItem(token, JSON.stringify({ id: templateId, name: templateName }));
            
            // Animare pe page transition
            document.body.classList.add('opacity-0', 'transition-opacity', 'duration-500');
            
            // Redirect after animation
            setTimeout(() => {
              window.location.href = `recording.html?ref=${token}`;
            }, 300); // Match this duration with CSS transition
            
          } catch (e) {
            console.error('Eroare la generarea tokenului sau stocarea în SessionStorage:', e);
            // Fallback: direct URL parameters if sessionStorage fails (less secure but functional)
            window.location.href = `recording.html?templateId=${templateId}&templateName=${encodeURIComponent(templateName)}`;
          }
        });
      });

      // 4. Gestionarea meniului hamburger (Open/Close)
      const menuToggle = document.getElementById('menu-toggle');
      const mainMenu = document.getElementById('main-menu');
      const closeMenu = document.getElementById('close-menu');
      const menuOverlay = document.getElementById('menu-overlay');

      const toggleMenu = () => {
        const isMenuOpen = !mainMenu.classList.contains('translate-x-full'); // Check current state
        mainMenu.classList.toggle('translate-x-full'); // Toggle class to slide menu
        menuOverlay.classList.toggle('hidden'); // Toggle overlay visibility
        menuToggle.setAttribute('aria-expanded', isMenuOpen); // Update aria-expanded based on new state
        document.body.classList.toggle('overflow-hidden', isMenuOpen); // Prevent scrolling body when menu is open
      };

      menuToggle.addEventListener('click', toggleMenu);
      closeMenu.addEventListener('click', toggleMenu);
      menuOverlay.addEventListener('click', toggleMenu);

      // Close menu on ESC key press
      document.addEventListener('keydown', (event) => {
        if (event.key === 'Escape' && !mainMenu.classList.contains('translate-x-full')) {
          toggleMenu();
        }
      });

      // 5. Funcționalitate de căutare (client-side placeholder)
      const searchInput = document.getElementById('report-search');
      searchInput.addEventListener('input', (event) => {
        const searchTerm = event.target.value.toLowerCase();
        // In a real application, this would likely trigger an AJAX request to a backend search API.
        console.log(`Căutare pentru: "${searchTerm}"`);
        // Example client-side filtering logic if reports were pre-loaded:
        // const allReports = document.querySelectorAll('.report-item');
        // allReports.forEach(report => {
        //   const reportText = report.textContent.toLowerCase();
        //   report.style.display = reportText.includes(searchTerm) ? '' : 'none';
        // });
      });

      // 6. Testabilitate și Debbuging Integrată
      if (location.search.includes('debug=true')) {
        console.log('🧪 DEBUG MODE ACTIVAT');
        // Activate additional logs or UI elements for testing.
        // E.g., const debugInfo = document.createElement('div');
        // debugInfo.textContent = 'DEBUG MODE ACTIVE';
        // document.body.prepend(debugInfo);
      }

      // 7. Sloturi dinamice pentru extensii viitoare (plugin-uri)
      // This assumes a global 'AudioFormPlugin' object would be loaded separately (e.g., from another script)
      const pluginSlotDashboardTop = document.getElementById('plugin-slot-dashboard-top');
      if (window.AudioFormPlugin && typeof window.AudioFormPlugin.renderDashboardTop === 'function') {
        // Render method for a specific slot.
        pluginSlotDashboardTop.appendChild(window.AudioFormPlugin.renderDashboardTop());
      }
      // [hook] plugin-slot-dashboard-bottom - Example for another slot
      // const pluginSlotDashboardBottom = document.getElementById('plugin-slot-dashboard-bottom');
      // if (window.AudioFormPlugin && typeof window.AudioFormPlugin.renderDashboardBottom === 'function') {
      //   pluginSlotDashboardBottom.appendChild(window.AudioFormPlugin.renderDashboardBottom());
      // }
    });
  </script>
</body>
</html>
