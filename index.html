<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>LumiYE – Spațiul Tău</title>
  <!-- SEO Meta Tags -->
  <meta name="description" content="LumiYE – jurnal audio cu AI, în care îți poți exprima emoțiile și urmări progresul obiectivelor personale.">
  <meta property="og:title" content="LumiYE – Spațiul Tău Personal cu AI">
  <meta property="og:description" content="Înregistrează gândurile, primește feedback și urmărește progresul. Cu AI care te ascultă.">
  <meta property="og:image" content="https://placehold.co/1200x630/000000/FFFFFF?text=LumiYE_Social_Share"> <!-- Placeholder, înlocuiește cu o imagine reală -->
  <meta name="robots" content="index,follow">
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Stiluri CSS extrase în "assets/style.css" -->
  <style>
    /* Stiluri generale pentru corp și HTML */
    body, html {
      margin: 0;
      padding: 0;
      overflow: hidden; /* Ascunde scrollbar-urile pentru efectul de carusel */
      font-family: 'Inter', sans-serif;
      color: #2E2E2E; /* Text gri foarte închis */
      height: 100vh;
      width: 100vw;
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
    }

    /* Fundalul cu imaginea Pământ-Răsărit sau video */
    .background-media {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      z-index: 0;
      filter: brightness(0.8); /* Luminozitate ajustată pentru lizibilitate text */
      transition: filter 0.5s ease-in-out; /* Tranziție pentru efectul de pulsație */
    }

    /* Containerul principal al aplicației, care va găzdui toate paginile */
    #app-container {
      position: relative;
      width: 100%;
      height: 100%;
      overflow: hidden; /* Crucial pentru a ascunde părțile din pagini care nu sunt în centru */
    }

    /* Stiluri de bază pentru fiecare pagină */
    .app-page {
      position: absolute;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      background-color: rgba(255, 255, 255, 0.05); /* Fundal semi-transparent pentru efect de sticlă */
      backdrop-filter: blur(8px); /* Efect de blur pentru paginile din spate */
      transition: transform 0.5s ease-out, opacity 0.5s ease, z-index 0.5s step-end; /* Tranziții fluide */
      z-index: 5; /* Z-index de bază */
      box-sizing: border-box;
      padding: 20px;
      color: #2E2E2E; /* Culoare text implicită pentru pagini */
    }

    /* Pozițiile paginilor */
    .page-center {
      transform: translateX(0) translateY(0);
      opacity: 1;
      z-index: 10; /* Pagina centrală este deasupra */
      pointer-events: auto; /* Permite interacțiuni */
    }
    .page-top {
      transform: translateY(-100vh); /* Complet în afara ecranului sus */
      opacity: 0.7;
      pointer-events: none; /* Nu permite interacțiuni când e parțial vizibilă */
      z-index: 6;
    }
    .page-bottom {
      transform: translateY(100vh); /* Complet în afara ecranului jos */
      opacity: 0.7;
      pointer-events: none;
      z-index: 6;
    }
    .page-left {
      transform: translateX(-100vw); /* Complet în afara ecranului stânga */
      opacity: 0.7;
      pointer-events: none;
      z-index: 6;
    }
    .page-right {
      transform: translateX(100vw); /* Complet în afara ecranului dreapta */
      opacity: 0.7;
      pointer-events: none;
      z-index: 6;
    }

    /* Stiluri pentru etichetele paginilor */
    .page-label {
      position: absolute;
      background-color: rgba(255, 255, 255, 0.2);
      color: white;
      padding: 10px 16px; /* Mărește zona de hit */
      border-radius: 8px;
      font-size: 0.9rem; /* Mărește fontul */
      font-weight: bold;
      opacity: 0; /* Ascuns implicit */
      transition: opacity 0.3s ease;
      pointer-events: auto; /* Permite click pe etichetă */
      cursor: pointer;
      white-space: nowrap; /* Previne ruperea textului */
    }
    .page-label:hover {
      background-color: rgba(255, 255, 255, 0.3);
    }

    /* Vizibilitatea etichetelor în funcție de poziția paginii */
    .page-top .label-bottom { opacity: 1; bottom: 10px; left: 50%; transform: translateX(-50%); }
    .page-bottom .label-top { opacity: 1; top: 10px; left: 50%; transform: translateX(-50%); }
    .page-left .label-right { opacity: 1; right: 10px; top: 50%; transform: translateY(-50%); }
    .page-right .label-left { opacity: 1; left: 10px; top: 50%; transform: translateY(-50%); }

    /* Stiluri specifice pentru pagina Journal (Home) */
    #journal-page {
      background-color: transparent; /* Journal are fundalul principal */
    }

    /* Stiluri pentru "soare" - butonul central de înregistrare */
    .sun {
      @apply absolute rounded-full bg-yellow-300 shadow-2xl;
      width: 160px;
      height: 160px;
      transition: all 0.8s ease-in-out, background-color 0.5s ease;
      z-index: 20; /* Soarele este deasupra conținutului paginii */
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      font-size: 1.2rem;
    }
    /* Animația de expansiune a soarelui */
    .sun.expanding {
      width: 100vw;
      height: 100vh;
      left: 0 !important;
      top: 0 !important;
      border-radius: 0;
      z-index: 50; /* Aduce soarele în prim-plan maxim */
      background-color: #C7EDE6; /* Culoarea de accent verde mentă la expansiune */
    }

    /* Stiluri pentru egalizatorul audio */
    .equalizer {
      display: flex;
      justify-content: center;
      align-items: end;
      height: 40px;
      gap: 4px;
      margin-top: 12px;
    }
    .bar {
      width: 4px;
      height: 10px;
      background: #C7EDE6; /* Culoarea de accent verde mentă pentru bare */
      animation: bounce 1s infinite ease-in-out;
    }
    .bar:nth-child(2) { animation-delay: 0.1s; }
    .bar:nth-child(3) { animation-delay: 0.2s; }
    .bar:nth-child(4) { animation-delay: 0.3s; }
    .bar:nth-child(5) { animation-delay: 0.4s; }
    /* Animația de "săritură" a barelor egalizatorului */
    @keyframes bounce {
      0%, 100% { transform: scaleY(1); }
      50% { transform: scaleY(2); }
    }
    /* Ascunde secțiunea de înregistrare inițial */
    #rec-section {
      display: none;
    }
    /* Afișează secțiunea de înregistrare când soarele este "activ" */
    #sun.active + #rec-section {
      display: flex; /* Folosim flex pentru a centra conținutul */
    }

    /* Stiluri pentru modalul de inspirație */
    .modal {
      display: none; /* Ascuns implicit */
      position: fixed; /* Poziționat fix pe ecran */
      z-index: 100; /* Deasupra tuturor elementelor */
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto; /* Permite scroll dacă conținutul este prea mare */
      background-color: rgba(0,0,0,0.4); /* Fundal semi-transparent */
      backdrop-filter: blur(5px); /* Efect de blur */
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .modal-content {
      background-color: #FDFBF6; /* Fundal bej cald */
      margin: auto;
      padding: 20px;
      border-radius: 12px;
      width: 90%;
      max-width: 500px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      position: relative;
      color: #2E2E2E;
    }
    .close-button {
      color: #aaa;
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
    }
    .close-button:hover,
    .close-button:focus {
      color: #2E2E2E;
      text-decoration: none;
      cursor: pointer;
    }
    .loading-spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #C7EDE6; /* Verde mentă */
      border-radius: 50%;
      width: 30px;
      height: 30px;
      animation: spin 1s linear infinite;
      margin: 20px auto;
      display: none; /* Ascuns implicit */
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Stiluri pentru zona de transcriere live */
    .transcript-area {
      @apply w-full max-w-2xl bg-white/50 backdrop-blur-sm border border-white/30 rounded-xl shadow-lg p-6 overflow-y-auto;
      min-height: 200px;
      max-height: 60vh;
      color: #2E2E2E;
      margin-top: 20px; /* Spațiu sub mesajul de bun venit */
      display: none; /* Ascuns inițial */
    }
    .transcript-area p {
      color: #2E2E2E;
    }
    /* Animație subtilă pentru propozițiile care apar */
    .sentence-pop-in {
      animation: popIn 0.5s ease-out forwards;
      opacity: 0;
      transform: translateY(10px);
    }
    @keyframes popIn {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Stiluri pentru pulsarea fundalului în timpul înregistrării */
    .pulsating-background {
      animation: backgroundPulse 2s infinite ease-in-out;
    }
    @keyframes backgroundPulse {
      0% { filter: brightness(0.8); }
      50% { filter: brightness(1.0); } /* Ușoară dilatare a luminii */
      100% { filter: brightness(0.8); }
    }

    .speaking-background {
      animation: backgroundSpeak 0.5s infinite alternate ease-in-out;
    }
    @keyframes backgroundSpeak {
      0% { filter: brightness(0.8); }
      100% { filter: brightness(0.75); } /* Ușoară contracție a luminii */
    }

    /* Clasă pentru ascunderea elementelor */
    .hidden-element {
      opacity: 0;
      pointer-events: none;
      visibility: hidden;
      transition: opacity 0.5s ease;
    }

    /* Stiluri pentru pagina MyGoals */
    .input-glass {
      @apply bg-white/30 border border-white/40 rounded-md px-3 py-2 text-gray-800 w-full;
    }
    .input-glass::placeholder {
      color: #718096;
    }
    .action-button {
      @apply bg-blue-300 hover:bg-blue-400 text-white font-medium py-2 px-4 rounded-full transition-colors duration-200;
    }
    .glass {
      @apply backdrop-blur-lg bg-white/50 border border-white/30 rounded-xl shadow-lg;
    }

    /* Stiluri pentru pagina Reports */
    .score-emoji {
      font-size: 2.5rem;
    }
    .positive-text {
      color: #10B981;
    }
    .negative-text {
      color: #EF4444;
    }
    .intent-text {
      color: #FACC15;
    }

    /* Stiluri pentru pagina History */
    .session-card {
      @apply bg-white/50 backdrop-blur-sm shadow p-4 rounded-xl border border-white/30;
    }
  </style>
</head>
<body>
  <!-- Fundalul principal cu imaginea Pământ-Răsărit sau video -->
  <!-- Utilizăm un element <picture> pentru a oferi o imagine fallback dacă video-ul nu se încarcă -->
  <picture>
    <source srcset="path/to/your/background.mp4" type="video/mp4">
    <img src="fundal Lum 1.jpg" alt="Fundal Pământ Răsărit" class="background-media" id="backgroundMedia">
  </picture>
  <!-- IMPORTANT: Înlocuiește "path/to/your/background.mp4" cu calea reală către fișierul tău MP4.
       De asemenea, asigură-te că "fundal Lum 1.jpg" este în directorul "assets/images" sau calea este corectă. -->

  <!-- Containerul principal al aplicației -->
  <div id="app-container" class="relative w-full h-100vh">

    <!-- Pagina 1: Journal (Home) -->
    <div id="journal-page" class="app-page page-center">
      <!-- Etichete pentru navigare - vizibile doar când pagina NU este în centru -->
      <div class="page-label label-bottom" data-target-page="journal">Journal</div>
      <div class="page-label label-top" data-target-page="journal">Journal</div>
      <div class="page-label label-left" data-target-page="journal">Journal</div>
      <div class="page-label label-right" data-target-page="journal">Journal</div>

      <!-- Mesajul de bun venit și introducere -->
      <div id="welcomeMessage" class="text-center px-4 z-10 text-white">
        <h1 class="text-3xl font-semibold">Bun venit în spațiul tău</h1>
        <p class="mt-2 text-lg max-w-md mx-auto italic opacity-90">
          LumiYE este o evadare din prezentul agitat. Un loc în care poți să respiri, să simți, să fii.
        </p>
        <p class="mt-2 text-base max-w-sm mx-auto opacity-70">
          Fie că vrei să păstrezi o stare de bine sau să descarci ceva ce te apasă, <strong>acum</strong> e momentul.
        </p>
      </div>

      <!-- Butonul central "soare" pentru a începe sesiunea -->
      <div id="sun" class="sun mt-8">
        <span id="sun-text">🎙️ Începe Sesiunea</span>
      </div>

      <!-- Egalizatorul și textul de stare (vizibile doar la înregistrare activă) -->
      <div id="rec-section" class="absolute bottom-6 w-full flex-col items-center z-10 text-sm text-white">
        <div class="equalizer">
          <div class="bar"></div>
          <div class="bar"></div>
          <div class="bar"></div>
          <div class="bar"></div>
          <div class="bar"></div>
        </div>
        <p class="mt-2 text-center px-4" id="status-msg">
          Se memorizează starea ta actuală.<br />
          <span class="opacity-70 text-xs">Această memorizare va fi exclusiv în telefonul tău și în posesia ta.</span>
        </p>
      </div>

      <!-- Zona de transcriere live (ascunsă inițial) -->
      <div id="transcriptArea" class="transcript-area text-lg leading-relaxed">
        <p class="text-gray-500 text-center italic">Vorbește liber. LumiYE te ascultă...</p>
      </div>

      <!-- Modal pentru afișarea inspirației (nu se afișează automat la pornire) -->
      <div id="inspirationModal" class="modal">
        <div class="modal-content">
          <span class="close-button" id="closeModalButton">&times;</span>
          <h2 class="text-xl font-semibold mb-4 text-center">✨ Inspirația Ta ✨</h2>
          <div id="loadingSpinner" class="loading-spinner"></div>
          <p id="inspirationText" class="text-gray-700 leading-relaxed text-center"></p>
        </div>
      </div>
    </div>

    <!-- Pagina 2: Reports -->
    <div id="reports-page" class="app-page page-right">
      <div class="page-label label-bottom" data-target-page="reports">Reports</div>
      <div class="page-label label-top" data-target-page="reports">Reports</div>
      <div class="page-label label-left" data-target-page="reports">Reports</div>
      <div class="page-label label-right" data-target-page="reports">Reports</div>

      <div class="card w-full max-w-2xl mx-auto">
        <h1 class="text-2xl font-bold text-gray-800 text-center">Raportul Sesiunii Tale</h1>
        <p class="mt-2 text-sm text-gray-500 text-center" id="sessionPeriod">Perioadă: N/A</p>

        <div class="mt-6 text-center">
          <h2 class="section-title">Starea Emoțională Generală</h2>
          <p id="emotionalScore" class="text-3xl font-bold"></p>
          <p id="scoreEmoji" class="score-emoji mt-2"></p>
        </div>

        <div class="mt-4">
          <h2 class="section-title">Transcriere</h2>
          <p id="transcriptContent" class="text-gray-700 leading-relaxed whitespace-pre-wrap">
            Fără transcriere disponibilă.
          </p>
        </div>

        <div class="mt-6">
          <h2 class="section-title">Cuvinte Cheie</h2>
          <div id="highWordsList" class="mt-2">
            <h3 class="font-semibold positive-text">Cuvinte High:</h3>
            <ul class="list-disc list-inside text-gray-700" id="highWordsUl">
              <li>Niciun cuvânt "High" detectat.</li>
            </ul>
          </div>
          <div id="lowWordsList" class="mt-4">
            <h3 class="font-semibold negative-text">Cuvinte Low:</h3>
            <ul class="list-disc list-inside text-gray-700" id="lowWordsUl">
              <li>Niciun cuvânt "Low" detectat.</li>
            </ul>
          </div>
        </div>

        <div class="mt-4">
          <h2 class="section-title">Intenții Detectate</h2>
          <ul class="list-disc list-inside text-gray-700" id="intentiiList">
            <li>Nicio intenție detectată.</li>
          </ul>
        </div>

        <div class="mt-4">
          <h2 class="section-title">Analiza Respirației</h2>
          <p id="breathingAnalysis" class="text-gray-700">Fără analiză disponibilă.</p>
        </div>
      </div>
    </div>

    <!-- Pagina 3: My Goals -->
    <div id="mygoals-page" class="app-page page-bottom">
      <div class="page-label label-bottom" data-target-page="mygoals">My Goals</div>
      <div class="page-label label-top" data-target-page="mygoals">My Goals</div>
      <div class="page-label label-left" data-target-page="mygoals">My Goals</div>
      <div class="page-label label-right" data-target-page="mygoals">My Goals</div>

      <div class="max-w-xl mx-auto mt-10 w-full">
        <h1 class="text-2xl font-semibold mb-6 text-center">🎯 Obiectivele tale</h1>

        <div id="goals-list" class="space-y-4 mb-6">
          <!-- Obiective adăugate vor apărea aici -->
        </div>

        <form id="goal-form" class="glass p-4">
          <label class="block mb-2 text-gray-700">Adaugă un obiectiv nou:</label>
          <input id="goal-input" type="text" class="input-glass mb-3" placeholder="ex: Să fiu mai răbdător..." required />
          <button type="submit" class="action-button w-full">Adaugă Obiectiv</button>
        </form>

        <!-- Noul buton pentru rafinarea obiectivului cu Gemini API -->
        <button id="refineGoalButton" class="action-button w-full mt-4">✨ Refinează Obiectivul</button>
      </div>

      <!-- Modal pentru afișarea rafinării obiectivului -->
      <div id="refineGoalModal" class="modal">
        <div class="modal-content">
          <span class="close-button" id="closeRefineModalButton">&times;</span>
          <h2 class="text-xl font-semibold mb-4 text-center">✨ Sugestii pentru Obiectivul Tău ✨</h2>
          <div id="refineLoadingSpinner" class="loading-spinner"></div>
          <p id="refineGoalText" class="text-gray-700 leading-relaxed text-center"></p>
        </div>
      </div>
    </div>

    <!-- Pagina 4: History -->
    <div id="history-page" class="app-page page-left">
      <div class="page-label label-bottom" data-target-page="history">History</div>
      <div class="page-label label-top" data-target-page="history">History</div>
      <div class="page-label label-left" data-target-page="history">History</div>
      <div class="page-label label-right" data-target-page="history">History</div>

      <h1 class="text-2xl font-bold text-gray-800 mb-6 text-center">📜 Istoricul Sesiunilor</h1>

      <div id="historyList" class="w-full max-w-md space-y-4">
        <!-- Lista va fi generată din localStorage -->
      </div>
    </div>

    <!-- Pagina 5: Account (Placeholder) -->
    <div id="account-page" class="app-page page-top">
      <div class="page-label label-bottom" data-target-page="account">Account</div>
      <div class="page-label label-top" data-target-page="account">Account</div>
      <div class="page-label label-left" data-target-page="account">Account</div>
      <div class="page-label label-right" data-target-page="account">Account</div>

      <h1 class="text-2xl font-bold text-gray-800 mb-6 text-center">⚙️ Contul Meu</h1>
      <p class="text-gray-700 text-center">Detalii despre cont și setări vor fi disponibile aici.</p>
    </div>

  </div> <!-- End of #app-container -->

  <!-- Scripturi JavaScript extrase în "assets/main.js" -->
  <script>
    // Referințe la elementele DOM
    const appContainer = document.getElementById('app-container');
    const journalPage = document.getElementById('journal-page');
    const reportsPage = document.getElementById('reports-page');
    const mygoalsPage = document.getElementById('mygoals-page');
    const historyPage = document.getElementById('history-page');
    const accountPage = document.getElementById('account-page');
    const backgroundMedia = document.getElementById('backgroundMedia'); // Referință la elementul media de fundal

    const pages = {
      'journal': journalPage,
      'reports': reportsPage,
      'mygoals': mygoalsPage,
      'history': historyPage,
      'account': accountPage
    };

    // Ordinea paginilor pentru navigare intuitivă
    // Această ordine definește cum se mișcă paginile la swipe
    const pageOrder = ['account', 'history', 'journal', 'reports', 'mygoals'];
    let currentPageIndex = pageOrder.indexOf('journal'); // Pagina inițială este Journal (Home)

    // Referințe pentru elementele din Journal Page
    const sun = document.getElementById('sun');
    const sunText = document.getElementById('sun-text');
    const recSection = document.getElementById('rec-section');
    const welcomeMessage = document.getElementById('welcomeMessage');
    const transcriptArea = document.getElementById('transcriptArea');
    const inspirationModal = document.getElementById('inspirationModal');
    const closeModalButton = document.getElementById('closeModalButton');
    const inspirationText = document.getElementById('inspirationText');
    const loadingSpinner = document.getElementById('loadingSpinner');

    let isRecording = false;
    let recognition; // Web Speech API
    let startTime;
    const maxRecordingTime = 120; // 2 minute în secunde
    let recordingInterval;
    let currentTranscript = '';
    let silenceTimeout;

    // Referințe pentru elementele din MyGoals Page
    const goalForm = document.getElementById('goal-form');
    const goalInput = document.getElementById('goal-input');
    const goalsList = document.getElementById('goals-list');
    const refineGoalButton = document.getElementById('refineGoalButton');
    const refineGoalModal = document.getElementById('refineGoalModal');
    const closeRefineModalButton = document.getElementById('closeRefineModalButton');
    const refineGoalText = document.getElementById('refineGoalText');
    const refineLoadingSpinner = document.getElementById('refineLoadingSpinner');
    let savedGoals = JSON.parse(localStorage.getItem('myGoals') || '[]');

    // Referințe pentru elementele din Reports Page
    const sessionPeriod = document.getElementById('sessionPeriod');
    const emotionalScore = document.getElementById('emotionalScore');
    const scoreEmoji = document.getElementById('scoreEmoji');
    const transcriptContent = document.getElementById('transcriptContent');
    const highWordsUl = document.getElementById('highWordsUl');
    const lowWordsUl = document.getElementById('lowWordsUl');
    const intentiiList = document.getElementById('intentiiList');
    const breathingAnalysis = document.getElementById('breathingAnalysis');

    // Referințe pentru elementele din History Page
    const historyList = document.getElementById('historyList');

    // Variabile pentru detectarea swipe-ului
    let touchstartX = 0;
    let touchstartY = 0;
    let touchendX = 0;
    let touchendY = 0;
    let isSwiping = false; // Flag pentru a preveni multiple swipe-uri în timpul tranziției

    // --- Funcții de Utilitate ---

    /**
     * Simulează analiza NLP pentru text.
     * @param {string} text - Textul de analizat.
     * @returns {object} Un obiect cu numărul de cuvinte pozitive/negative și intenții detectate.
     */
    function analyzeText(text) {
      const positiveWords = ['bucurie', 'speranță', 'fericit', 'mulțumit', 'recunoștință', 'curaj', 'potențial', 'vreau', 'succes'];
      const negativeWords = ['nu pot', 'blocat', 'singur', 'eșec', 'trist', 'copleșit', 'stres', 'îndoieli', 'obosit'];

      let positives = 0;
      let negatives = 0;
      const lowerCaseText = text.toLowerCase();

      positiveWords.forEach(word => { if (lowerCaseText.includes(word)) positives++; });
      negativeWords.forEach(word => { if (lowerCaseText.includes(word)) negatives++; });

      let intentii = [];
      if (lowerCaseText.includes('nu mai vreau să fiu')) intentii.push(`"nu mai vreau să fiu..." → evitare`);
      if (lowerCaseText.includes('vreau să devin')) intentii.push(`"vreau să devin..." → progres`);
      return { positives, negatives, intentii };
    }

    /**
     * Simulează analiza respirației pe baza textului și duratei.
     * @param {string} text - Textul transcris.
     * @param {number} durationInSeconds - Durata înregistrării în secunde.
     * @returns {object} Un obiect cu WPM și feedback despre respirație.
     */
    function analyzeBreathing(text, durationInSeconds) {
      const words = text.split(/\s+/).filter(word => word.length > 0);
      const wordCount = words.length;
      const wpm = durationInSeconds > 0 ? (wordCount / durationInSeconds) * 60 : 0;
      const sentences = text.split(/[.!?]/).filter(s => s.trim().length > 0);
      const averageSentenceLength = sentences.length > 0 ? wordCount / sentences.length : 0;

      let breathingFeedback = '';
      if (wpm > 180) breathingFeedback = 'Ai vorbit într-un ritm rapid azi.';
      else if (wpm < 80 && wpm > 0) breathingFeedback = 'Ai un ritm de vorbire calm.';

      if (sentences.length > 1 && averageSentenceLength < 5) breathingFeedback += ' Pauzele scurte pot semnala agitație.';
      else if (sentences.length > 1 && averageSentenceLength > 15) breathingFeedback += ' Fluxul coerent al vorbirii.';
      return { wpm: wpm.toFixed(0), breathingFeedback };
    }

    /**
     * Calculează scorul emoțional și emoji-ul corespunzător.
     * @param {number} positives - Numărul de cuvinte pozitive.
     * @param {number} negatives - Numărul de cuvinte negative.
     * @returns {object} Un obiect cu scorul (text) și emoji-ul.
     */
    function getEmotionalScore(positives, negatives) {
      if (positives === 0 && negatives === 0) return { score: 'Neutru', emoji: '😐' };
      const total = positives + negatives;
      const percentagePositive = (positives / total) * 100;

      if (percentagePositive >= 75) return { score: 'Foarte Pozitiv', emoji: '😊' };
      else if (percentagePositive >= 50) return { score: 'Pozitiv', emoji: '🙂' };
      else if (percentagePositive >= 25) return { score: 'Echilibrat', emoji: '😌' };
      else return { score: 'Mai degrabă Negativ', emoji: '😔' };
    }

    // --- Logică de Navigare (Carusel) ---

    /**
     * Actualizează pozițiile CSS ale paginilor în funcție de pagina curentă.
     * De asemenea, gestionează vizibilitatea etichetelor și pointer-events.
     */
    function updatePagePositions() {
      // Ascunde toate etichetele inițial și dezactivează pointer-events pentru toate paginile
      document.querySelectorAll('.page-label').forEach(label => label.style.opacity = '0');
      document.querySelectorAll('.app-page').forEach(page => page.style.pointerEvents = 'none');

      for (let i = 0; i < pageOrder.length; i++) {
        const pageId = pageOrder[i];
        const pageElement = pages[pageId];
        pageElement.classList.remove('page-center', 'page-top', 'page-bottom', 'page-left', 'page-right');

        if (i === currentPageIndex) {
          pageElement.classList.add('page-center');
          pageElement.style.pointerEvents = 'auto'; // Activează interacțiunile pentru pagina centrală
        } else {
          // Calculează poziția relativă față de pagina centrală
          // Această logică este crucială pentru a determina ce pagină este "sus", "jos", "stânga", "dreapta"
          const relativeIndex = (i - currentPageIndex + pageOrder.length) % pageOrder.length;

          if (relativeIndex === 1) { // Pagina "următoare" în sens orar (ex: Journal -> Reports)
            if (pageId === 'reports') pageElement.classList.add('page-right');
            else if (pageId === 'mygoals') pageElement.classList.add('page-bottom');
            else if (pageId === 'history') pageElement.classList.add('page-left');
            else if (pageId === 'account') pageElement.classList.add('page-top');
          } else if (relativeIndex === pageOrder.length - 1) { // Pagina "anterioară" în sens orar (ex: Journal <- Account)
            if (pageId === 'account') pageElement.classList.add('page-top');
            else if (pageId === 'history') pageElement.classList.add('page-left');
            else if (pageId === 'mygoals') pageElement.classList.add('page-bottom');
            else if (pageId === 'reports') pageElement.classList.add('page-right');
          }
          // Afișează etichetele doar pentru paginile adiacente vizibile
          if (relativeIndex === 1 || relativeIndex === pageOrder.length - 1) {
            pageElement.querySelectorAll('.page-label').forEach(label => label.style.opacity = '1');
          }
        }
      }
    }

    /**
     * Navighează la o pagină specifică cu o animație de tranziție.
     * @param {string} targetPageId - ID-ul paginii țintă (ex: 'reports', 'mygoals').
     */
    function navigateTo(targetPageId) {
      if (isSwiping) return; // Previne navigarea multiplă în timpul tranziției
      isSwiping = true;

      const targetPageIndex = pageOrder.indexOf(targetPageId);
      if (targetPageIndex === -1 || targetPageIndex === currentPageIndex) {
        isSwiping = false;
        return;
      }

      const currentPageElement = pages[pageOrder[currentPageIndex]];
      const targetPageElement = pages[targetPageId];

      // Ascunde etichetele paginii curente înainte de tranziție
      currentPageElement.querySelectorAll('.page-label').forEach(label => label.style.opacity = '0');
      currentPageElement.style.pointerEvents = 'none'; // Dezactivează interacțiunile paginii curente

      // Determină direcția de ieșire a paginii curente și de intrare a paginii țintă
      let exitTransform = '';
      let enterTransform = '';

      // Calculează diferența de index pentru a determina direcția
      const deltaIndex = (targetPageIndex - currentPageIndex + pageOrder.length) % pageOrder.length;

      // Vertical swipe
      if (targetPageId === 'account' && currentPageId === 'journal') { // Journal (center) -> Account (top)
          exitTransform = 'translateY(100vh)'; // Journal iese în jos
          enterTransform = 'translateY(0)'; // Account intră în centru
      } else if (targetPageId === 'journal' && currentPageId === 'account') { // Account (top) -> Journal (center)
          exitTransform = 'translateY(-100vh)'; // Account iese în sus
          enterTransform = 'translateY(0)'; // Journal intră în centru
      } else if (targetPageId === 'mygoals' && currentPageId === 'journal') { // Journal (center) -> MyGoals (bottom)
          exitTransform = 'translateY(-100vh)'; // Journal iese în sus
          enterTransform = 'translateY(0)'; // MyGoals intră în centru
      } else if (targetPageId === 'journal' && currentPageId === 'mygoals') { // MyGoals (bottom) -> Journal (center)
          exitTransform = 'translateY(100vh)'; // MyGoals iese în jos
          enterTransform = 'translateY(0)'; // Journal intră în centru
      }
      // Horizontal swipe
      else if (targetPageId === 'reports' && currentPageId === 'journal') { // Journal (center) -> Reports (right)
          exitTransform = 'translateX(-100vw)'; // Journal iese în stânga
          enterTransform = 'translateX(0)'; // Reports intră în centru
      } else if (targetPageId === 'journal' && currentPageId === 'reports') { // Reports (right) -> Journal (center)
          exitTransform = 'translateX(100vw)'; // Reports iese în dreapta
          enterTransform = 'translateX(0)'; // Journal intră în centru
      } else if (targetPageId === 'history' && currentPageId === 'journal') { // Journal (center) -> History (left)
          exitTransform = 'translateX(100vw)'; // Journal iese în dreapta
          enterTransform = 'translateX(0)'; // History intră în centru
      } else if (targetPageId === 'journal' && currentPageId === 'history') { // History (left) -> Journal (center)
          exitTransform = 'translateX(-100vw)'; // History iese în stânga
          enterTransform = 'translateX(0)'; // Journal intră în centru
      } else { // Fallback pentru tranziții între pagini non-adiacente direct de la Journal
          // Pentru MVP, simplificăm: dacă nu e o tranziție directă, facem un "reset" vizual
          // și apoi aducem pagina țintă în centru.
          // O implementare completă ar calcula calea optimă prin carusel.
          currentPageElement.style.transform = 'scale(0.8)'; // Micșorează pagina curentă
          targetPageElement.style.transform = 'scale(0.8)'; // Micșorează pagina țintă înainte de a o aduce
          setTimeout(() => {
              currentPageElement.style.transform = 'translateX(0) translateY(0)'; // Resetează poziția paginii curente
              targetPageElement.style.transform = 'translateX(0) translateY(0)'; // Resetează poziția paginii țintă
          }, 250); // Jumătate din durata tranziției
      }

      currentPageElement.style.transform = exitTransform;
      targetPageElement.style.transform = enterTransform;

      // Actualizează indexul paginii curente
      currentPageIndex = targetPageIndex;

      // Re-aplica clasele de poziție după un scurt delay pentru a permite tranziția
      setTimeout(() => {
        updatePagePositions();
        // Reîncarcă conținutul paginilor la navigare, dacă este necesar
        if (targetPageId === 'reports') populateReport(JSON.parse(localStorage.getItem('current_session_data')));
        if (targetPageId === 'history') loadHistory();
        if (targetPageId === 'mygoals') {
            goalsList.innerHTML = '';
            savedGoals.forEach(addGoalToDOM);
        }
        // Asigură că UI-ul Journal este resetat la revenire
        if (targetPageId === 'journal') {
            resetJournalUI();
        }
        isSwiping = false; // Permite din nou swipe-urile după finalizarea tranziției
      }, 500); // Durata tranziției CSS
    }

    /**
     * Resetează starea UI-ului paginii Journal (Home).
     * Este apelată după înregistrare sau la navigarea către/de la Journal.
     */
    function resetJournalUI() {
        welcomeMessage.classList.remove('hidden-element');
        sunText.textContent = '🎙️ Începe Sesiunea';
        sun.classList.remove('active'); // Elimină clasa 'active' de pe soare
        backgroundMedia.classList.remove('pulsating-background', 'speaking-background'); // Oprește animațiile de fundal
        recSection.style.display = 'none';
        transcriptArea.style.display = 'none';
        // Afișează din nou paginile secundare și etichetele
        for (const id in pages) {
            if (id !== 'journal') { // Doar celelalte pagini
                pages[id].classList.remove('hidden-element');
            }
        }
        updatePagePositions(); // Re-afișează etichetele
    }


    // --- Logică de Înregistrare (Journal Page) ---

    /**
     * Pornește procesul de înregistrare vocală.
     */
    function startRecording() {
      if (!('webkitSpeechRecognition' in window)) {
        document.getElementById('status-msg').textContent = 'API-ul de recunoaștere vocală nu este suportat de browserul tău.';
        return;
      }

      recognition = new webkitSpeechRecognition();
      recognition.continuous = true;
      recognition.interimResults = true;
      recognition.lang = 'ro-RO';

      let finalTranscript = '';

      recognition.onstart = () => {
        isRecording = true;
        startTime = Date.now();
        sunText.textContent = '🎙️';
        sun.classList.add('active'); // Activează egalizatorul
        backgroundMedia.classList.add('pulsating-background'); // Pulsație pe fundal
        recSection.style.display = 'flex';
        welcomeMessage.classList.add('hidden-element');
        transcriptArea.style.display = 'block';
        transcriptArea.innerHTML = '<p class="text-gray-500 text-center italic">Vorbește liber. LumiYE te ascultă...</p>';
        currentTranscript = '';

        // Ascunde toate etichetele paginilor
        document.querySelectorAll('.page-label').forEach(label => label.style.opacity = '0');
        // Ascunde toate paginile secundare
        for (const id in pages) {
            if (id !== 'journal') { // Ascunde doar celelalte pagini, nu și journal itself
                pages[id].classList.add('hidden-element');
            }
        }

        resetSilenceTimeout();
      };

      recognition.onresult = (event) => {
        let hasSpeech = false;
        for (let i = event.resultIndex; i < event.results.length; ++i) {
          if (event.results[i].isFinal) {
            finalTranscript += event.results[i][0].transcript + '. ';
            const p = document.createElement('p');
            p.textContent = event.results[i][0].transcript;
            p.classList.add('sentence-pop-in');
            transcriptArea.appendChild(p);
            transcriptArea.scrollTop = transcriptArea.scrollHeight;
            currentTranscript = finalTranscript;
            hasSpeech = true;
          }
        }

        if (hasSpeech) {
          backgroundMedia.classList.remove('pulsating-background');
          backgroundMedia.classList.add('speaking-background'); // Contracție când vorbești
          resetSilenceTimeout();
        } else {
          backgroundMedia.classList.remove('speaking-background');
          backgroundMedia.classList.add('pulsating-background'); // Dilatare când e liniște
        }
      };

      recognition.onend = () => {
        if (isRecording) {
          isRecording = false;
          clearTimeout(silenceTimeout);
          backgroundMedia.classList.remove('pulsating-background', 'speaking-background');
          sun.classList.remove('active');
          recSection.style.display = 'none';
          transcriptArea.style.display = 'none';
          processSession(currentTranscript);
        }
      };

      recognition.onerror = (event) => {
        console.error('Eroare recunoaștere vocală:', event.error);
        document.getElementById('status-msg').textContent = `Eroare: ${event.error}. Te rugăm să încerci din nou.`;
        isRecording = false;
        clearTimeout(silenceTimeout);
        backgroundMedia.classList.remove('pulsating-background', 'speaking-background');
        sun.classList.remove('active');
        recSection.style.display = 'none';
        transcriptArea.style.display = 'none';
        resetJournalUI(); // Resetează UI-ul Journal
      };

      recognition.start();

      recordingInterval = setTimeout(() => {
        if (isRecording) stopRecording();
      }, maxRecordingTime * 1000);
    }

    /**
     * Oprește procesul de înregistrare vocală.
     */
    function stopRecording() {
      if (isRecording) {
        recognition.stop();
        isRecording = false;
        clearTimeout(silenceTimeout);
        clearTimeout(recordingInterval);
        backgroundMedia.classList.remove('pulsating-background', 'speaking-background');
        sun.classList.remove('active');
        recSection.style.display = 'none';
        transcriptArea.style.display = 'none';
        processSession(currentTranscript);
      }
    }

    /**
     * Resetează timeout-ul de liniște și ajustează animația de fundal.
     */
    function resetSilenceTimeout() {
      clearTimeout(silenceTimeout);
      backgroundMedia.classList.remove('speaking-background');
      backgroundMedia.classList.add('pulsating-background');
      silenceTimeout = setTimeout(() => {
        if (isRecording) stopRecording();
        console.log("Înregistrare oprită din cauza liniștii prelungite.");
      }, 10000); // 10 secunde de liniște
    }

    /**
     * Procesează sesiunea de înregistrare, analizează textul și salvează datele.
     * @param {string} transcript - Transcrierea sesiunii.
     */
    function processSession(transcript) {
      const duration = (Date.now() - startTime) / 1000;
      // Sanitize input before analysis and saving (Security recommendation)
      const cleanTranscript = DOMPurify.sanitize(transcript); // Requires DOMPurify library if used
      const { positives, negatives, intentii } = analyzeText(cleanTranscript);
      const { wpm, breathingFeedback } = analyzeBreathing(cleanTranscript, duration);

      const sessionData = {
        time: new Date().toLocaleString('ro-RO', { dateStyle: 'medium', timeStyle: 'short' }),
        transcript: cleanTranscript,
        duration: duration.toFixed(0),
        analysis: { positives, negatives, highWords: [], lowWords: [], intentii, wpm, breathingFeedback }
      };

      localStorage.setItem('current_session_data', JSON.stringify(sessionData));

      // După înregistrare, navigăm la pagina de rapoarte
      navigateTo('reports');
      resetJournalUI(); // Resetează UI-ul Journal
    }

    // --- Logică Gemini API (Inspirație) ---
    /**
     * Generează o frază inspirațională folosind Gemini API.
     * Notă: În producție, cheia API ar trebui să fie protejată printr-un backend-proxy.
     */
    async function generateInspiration() {
      inspirationText.textContent = '';
      loadingSpinner.style.display = 'block';
      inspirationModal.style.display = 'flex';

      try {
        let chatHistory = [];
        const prompt = "Generează o frază scurtă, pozitivă și inspirațională despre auto-reflecție, creștere personală sau liniște interioară. Fraza să fie concisă și să inspire calm.";
        chatHistory.push({ role: "user", parts: [{ text: prompt }] });
        const payload = { contents: chatHistory };
        const apiKey = ""; // Lăsați gol pentru ca Canvas să furnizeze cheia API în runtime
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

        const response = await fetch(apiUrl, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        const result = await response.json();

        if (result.candidates && result.candidates.length > 0 && result.candidates[0].content && result.candidates[0].content.parts && result.candidates[0].content.parts.length > 0) {
          inspirationText.textContent = result.candidates[0].content.parts[0].text;
        } else {
          inspirationText.textContent = "Nu am putut genera inspirație. Te rugăm să încerci din nou.";
          console.error("Structura răspunsului API este neașteptată:", result);
        }
      } catch (error) {
        inspirationText.textContent = "A apărut o eroare la generarea inspirației. Verifică conexiunea la internet.";
        console.error("Eroare la apelul Gemini API:", error);
      } finally {
        loadingSpinner.style.display = 'none';
      }
    }

    // --- Logică MyGoals Page ---
    /**
     * Adaugă un obiectiv în DOM.
     * @param {string} goal - Textul obiectivului.
     */
    function addGoalToDOM(goal) {
      // Sanitize input before adding to DOM (Security recommendation)
      const cleanGoal = DOMPurify.sanitize(goal); // Requires DOMPurify library if used
      const div = document.createElement('div');
      div.className = 'glass p-3 flex items-center justify-between';
      div.innerHTML = `<span class="block text-gray-800">📝 ${cleanGoal}</span><button class="delete-goal-button text-red-500 hover:text-red-700 ml-4 text-xl">&times;</button>`;
      goalsList.appendChild(div);
      div.querySelector('.delete-goal-button').addEventListener('click', () => removeGoalFromDOM(goal, div));
    }

    /**
     * Elimină un obiectiv din DOM și localStorage.
     * @param {string} goalToRemove - Textul obiectivului de eliminat.
     * @param {HTMLElement} element - Elementul DOM al obiectivului.
     */
    function removeGoalFromDOM(goalToRemove, element) {
      const index = savedGoals.indexOf(goalToRemove);
      if (index > -1) {
        savedGoals.splice(index, 1);
        localStorage.setItem('myGoals', JSON.stringify(savedGoals));
        element.remove();
      }
    }

    /**
     * Rafinează un obiectiv folosind Gemini API.
     */
    async function refineGoal() {
      let goalToRefine = '';
      if (savedGoals.length > 0) {
        goalToRefine = savedGoals[savedGoals.length - 1]; // Ia ultimul obiectiv adăugat
      } else {
        refineGoalText.textContent = "Nu ai adăugat încă niciun obiectiv. Adaugă unul pentru a primi sugestii.";
        refineLoadingSpinner.style.display = 'none';
        refineGoalModal.style.display = 'flex';
        return;
      }

      refineGoalText.textContent = '';
      refineLoadingSpinner.style.display = 'block';
      refineGoalModal.style.display = 'flex';

      try {
        let chatHistory = [];
        const prompt = `Pentru obiectivul "${DOMPurify.sanitize(goalToRefine)}", generează o scurtă sugestie de rafinare care să-l facă mai specific și acționabil, sau o afirmație pozitivă legată de atingerea acestui obiectiv. Fii concis și încurajator.`;
        chatHistory.push({ role: "user", parts: [{ text: prompt }] });
        const payload = { contents: chatHistory };
        const apiKey = "";
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

        const response = await fetch(apiUrl, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        const result = await response.json();

        if (result.candidates && result.candidates.length > 0 && result.candidates[0].content && result.candidates[0].content.parts && result.candidates[0].content.parts.length > 0) {
          refineGoalText.textContent = result.candidates[0].content.parts[0].text;
        } else {
          refineGoalText.textContent = "Nu am putut genera sugestii. Te rugăm să încerci din nou.";
          console.error("Structura răspunsului API este neașteptată:", result);
        }
      } catch (error) {
        refineGoalText.textContent = "A apărut o eroare la generarea sugestiilor. Verifică conexiunea la internet.";
        console.error("Eroare la apelul Gemini API:", error);
      } finally {
        refineLoadingSpinner.style.display = 'none';
      }
    }

    // --- Logică Reports Page ---
    /**
     * Populează pagina de rapoarte cu datele sesiunii.
     * @param {object} session - Obiectul sesiunii.
     */
    function populateReport(session) {
      if (!session) { // Handle case where session data might be missing
        sessionPeriod.textContent = 'Perioadă: N/A';
        transcriptContent.textContent = 'Nicio sesiune salvată recent.';
        emotionalScore.textContent = 'N/A';
        scoreEmoji.textContent = '🤷';
        highWordsUl.innerHTML = '<li>Niciun cuvânt "High" detectat.</li>';
        lowWordsUl.innerHTML = '<li>Niciun cuvânt "Low" detectat.</li>';
        intentiiList.innerHTML = '<li>Nicio intenție detectată.</li>';
        breathingAnalysis.textContent = 'Fără analiză disponibilă.';
        return;
      }
      sessionPeriod.textContent = `Perioadă: ${session.time || 'Timp necunoscut'} (Durată: ${session.duration || 'N/A'} secunde)`;
      transcriptContent.textContent = session.transcript || 'Fără transcriere disponibilă.';

      highWordsUl.innerHTML = '';
      lowWordsUl.innerHTML = '';

      if (session.analysis.positives > 0) {
        const li = document.createElement('li');
        li.textContent = `(Au fost detectate ${session.analysis.positives} cuvinte pozitive)`;
        highWordsUl.appendChild(li);
      } else {
        highWordsUl.innerHTML = '<li>Niciun cuvânt "High" detectat.</li>';
      }

      if (session.analysis.negatives > 0) {
        const li = document.createElement('li');
        li.textContent = `(Au fost detectate ${session.analysis.negatives} cuvinte negative)`;
        lowWordsUl.appendChild(li);
      } else {
        lowWordsUl.innerHTML = '<li>Niciun cuvânt "Low" detectat.</li>';
      }

      intentiiList.innerHTML = '';
      if (session.analysis.intentii && session.analysis.intentii.length > 0) {
        session.analysis.intentii.forEach(intentie => {
          const li = document.createElement('li');
          li.textContent = intentie;
          li.classList.add('intent-text');
          intentiiList.appendChild(li);
        });
      } else {
        intentiiList.innerHTML = '<li>Nicio intenție detectată.</li>';
      }

      breathingAnalysis.textContent = session.analysis.breathingFeedback || 'Fără analiză disponibilă.';

      const { score, emoji } = getEmotionalScore(session.analysis.positives, session.analysis.negatives);
      emotionalScore.textContent = score;
      scoreEmoji.textContent = emoji;
    }

    // --- Logică History Page ---
    /**
     * Încarcă și afișează istoricul sesiunilor din localStorage.
     */
    function loadHistory() {
      const rawData = localStorage.getItem('lumiye_sessions');
      if (!rawData) {
        historyList.innerHTML = '<p class="text-gray-500 text-center">Nicio sesiune salvată încă.</p>';
        return;
      }

      const sessions = JSON.parse(rawData);
      if (!sessions.length) {
        historyList.innerHTML = '<p class="text-gray-500 text-center">Nicio sesiune salvată încă.</p>';
        return;
      }

      historyList.innerHTML = ''; // Curăță lista înainte de a o repopula
      sessions.reverse().forEach((session, index) => {
        const item = document.createElement('div');
        item.className = 'session-card';
        const isFirstSession = (sessions.length - 1 - index) === 0;

        item.innerHTML = `
          <h2 class="text-lg font-semibold text-gray-800">Sesiune #${sessions.length - index} ${isFirstSession ? '<span class="text-blue-500 text-sm">(Origine)</span>' : ''}</h2>
          <p class="text-sm text-gray-600">🕒 ${session.time || 'Timp necunoscut'} (Durată: ${session.duration || 'N/A'} secunde)</p>
          <p class="mt-2 text-gray-700 line-clamp-3">${session.transcript || 'Fără transcriere disponibilă.'}</p>
          <div class="mt-2 text-sm">
            <span class="text-green-600">Pozitive: ${session.analysis.positives || 0}</span> |
            <span class="text-red-600">Negative: ${session.analysis.negatives || 0}</span> |
            <span class="text-blue-500">WPM: ${session.analysis.wpm || 'N/A'}</span>
          </div>
        `;
        historyList.appendChild(item);
      });
    }


    // --- Inițializare și Evenimente ---

    // Inițializare pagini și încărcare date
    document.addEventListener('DOMContentLoaded', () => {
      updatePagePositions(); // Setează pozițiile inițiale ale paginilor
      loadHistory(); // Încarcă istoricul la pornire
      savedGoals.forEach(addGoalToDOM); // Încarcă obiectivele la pornire

      // Verifică dacă există date de sesiune curente și populează raportul dacă este cazul
      const currentSessionData = localStorage.getItem('current_session_data');
      if (currentSessionData) {
        populateReport(JSON.parse(currentSessionData));
      } else {
        populateReport(null); // Afișează un raport gol dacă nu există date
      }
    });

    // Evenimente pentru butonul Soare (înregistrare)
    sun.addEventListener('mousedown', () => {
      if (!isRecording) {
        // Previne swipe-ul în timpul animației de expansiune
        isSwiping = true;
        holdTimeout = setTimeout(() => {
          sun.classList.add('expanding');
          sunText.textContent = 'Inspiră profund';
          setTimeout(() => {
            sun.classList.remove('expanding');
            startRecording();
            isSwiping = false; // Permite swipe-ul după ce începe înregistrarea
          }, 2000);
        }, 1200);
      } else {
        stopRecording();
      }
    });
    sun.addEventListener('mouseup', () => {
      if (!isRecording) { // Anulează doar dacă nu am intrat în modul de înregistrare
        clearTimeout(holdTimeout);
        isSwiping = false; // Resetăm flag-ul de swipe
      }
    });
    sun.addEventListener('mouseleave', () => {
      if (!isRecording) { // Anulează doar dacă nu am intrat în modul de înregistrare
        clearTimeout(holdTimeout);
        isSwiping = false; // Resetăm flag-ul de swipe
      }
    });

    // Evenimente pentru modalul de inspirație
    closeModalButton.addEventListener('click', () => { inspirationModal.style.display = 'none'; });
    window.addEventListener('click', (event) => { if (event.target == inspirationModal) inspirationModal.style.display = 'none'; });

    // Evenimente pentru modalul de rafinare a obiectivului
    closeRefineModalButton.addEventListener('click', () => { refineGoalModal.style.display = 'none'; });
    window.addEventListener('click', (event) => { if (event.target == refineGoalModal) refineGoalModal.style.display = 'none'; });

    // Evenimente pentru butoanele de acțiune specifice paginilor
    goalForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const goal = goalInput.value.trim();
      if (goal) {
        addGoalToDOM(goal); // Adaugă în DOM
        savedGoals.push(goal); // Adaugă în array-ul local
        localStorage.setItem('myGoals', JSON.stringify(savedGoals)); // Salvează în localStorage
        goalInput.value = '';
      }
    });
    refineGoalButton.addEventListener('click', refineGoal);

    // --- Logică de detectare swipe pentru navigare ---
    appContainer.addEventListener('touchstart', e => {
      if (isRecording || isSwiping) return; // Blochează swipe-ul în timpul înregistrării sau tranziției
      touchstartX = e.changedTouches[0].screenX;
      touchstartY = e.changedTouches[0].screenY;
    });

    appContainer.addEventListener('touchend', e => {
      if (isRecording || isSwiping) return; // Blochează swipe-ul în timpul înregistrării sau tranziției
      touchendX = e.changedTouches[0].screenX;
      touchendY = e.changedTouches[0].screenY;
      handleGesture();
    });

    function handleGesture() {
      const swipeThreshold = 75; // Numărul minim de pixeli pentru a detecta un swipe
      const deltaX = touchendX - touchstartX;
      const deltaY = touchendY - touchstartY;

      // Determină dacă swipe-ul este mai degrabă orizontal sau vertical
      const isHorizontalSwipe = Math.abs(deltaX) > Math.abs(deltaY);

      if (isHorizontalSwipe && Math.abs(deltaX) > swipeThreshold) {
        if (deltaX < 0) { // Swipe Left (tragi de la dreapta la stânga, vrei pagina din dreapta)
          if (currentPageIndex === pageOrder.indexOf('journal')) navigateTo('reports');
          else if (currentPageIndex === pageOrder.indexOf('history')) navigateTo('journal'); // History -> Journal
          // Adaugă mai multe cazuri pentru navigarea orizontală
        } else { // Swipe Right (tragi de la stânga la dreapta, vrei pagina din stânga)
          if (currentPageIndex === pageOrder.indexOf('journal')) navigateTo('history');
          else if (currentPageIndex === pageOrder.indexOf('reports')) navigateTo('journal'); // Reports -> Journal
          // Adaugă mai multe cazuri pentru navigarea orizontală
        }
      } else if (!isHorizontalSwipe && Math.abs(deltaY) > swipeThreshold) {
        if (deltaY < 0) { // Swipe Up (tragi de jos în sus, vrei pagina de jos)
          if (currentPageIndex === pageOrder.indexOf('journal')) navigateTo('mygoals');
          else if (currentPageIndex === pageOrder.indexOf('account')) navigateTo('journal'); // Account -> Journal
          // Adaugă mai multe cazuri pentru navigarea verticală
        } else { // Swipe Down (tragi de sus în jos, vrei pagina de sus)
          if (currentPageIndex === pageOrder.indexOf('journal')) navigateTo('account');
          else if (currentPageId === pageOrder.indexOf('mygoals')) navigateTo('journal'); // MyGoals -> Journal
          // Adaugă mai multe cazuri pentru navigarea verticală
        }
      }
    }

  </script>
</body>
</html>
